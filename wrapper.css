:root{
  --pad-x: 0vw; --pad-y: 0vh; --pad-scale: 1.24; --pad-opacity: 0.92;
  --start-x: 0vw; --start-y: 0vh; --start-scale: 1.00; --start-opacity: 0.92;
  --sa-top: env(safe-area-inset-top, 0px);
  --sa-right: env(safe-area-inset-right, 0px);
  --sa-bottom: env(safe-area-inset-bottom, 0px);
  --sa-left: env(safe-area-inset-left, 0px);
  --bg:#000; --glass:rgba(25,25,25,.85); --glassSoft:rgba(25,25,25,.60); --border:rgba(255,255,255,.22); --ink:#e8f0f2;
  --r-xl:16px; --r-pill:999px; --gap:10px;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif}
#wrap{position:fixed;inset:0}

/* Gate */
#gate{position:fixed;inset:0;display:grid;place-items:center;z-index:99999;background:radial-gradient(120vmax 120vmax at 50% 50%,rgba(0,0,0,.85),rgba(0,0,0,.95))}
#gate.hidden{display:none}
.gate-card{padding:18px 22px;border-radius:var(--r-xl);background:var(--glassSoft);backdrop-filter:blur(8px);border:1px solid var(--border);text-align:center}
.gate-title{font-weight:800;margin-bottom:6px}.gate-sub{opacity:.9;margin-bottom:10px}.gate-actions{margin-bottom:6px}.gate-hint{opacity:.75;font-size:.9em}

/* Stage */
#stage{position:fixed;inset:0;background:#000;z-index:1}
#gameframe{position:absolute;inset:0;width:100%;height:100%;border:0;background:#000}

/* Buttons */
.btn{display:inline-grid;place-items:center;padding:12px 20px;border-radius:var(--r-pill);border:1px solid var(--border);background:rgba(255,255,255,.12);color:#fff;user-select:none;touch-action:manipulation;cursor:pointer;transition:transform .06s ease, background .12s ease, border-color .12s ease, opacity .12s ease}
.btn.ghost{background:rgba(255,255,255,.08)}.btn.sm{padding:8px 12px;font-size:14px}
.btn:active,.btn.active{transform:scale(.98);background:rgba(255,255,255,.5);border-color:#fff}
.btn[disabled]{opacity:.45;pointer-events:none}

/* Top bar — FIXED & above controls */
#topbar{position:fixed;right:calc(10px + var(--sa-right));top:calc(10px + var(--sa-top));display:flex;gap:8px;z-index:9500;pointer-events:auto}

/* Toast */
#toast{position:absolute;left:50%;top:calc(12px + var(--sa-top));transform:translateX(-50%);background:rgba(0,0,0,.7);color:#fff;padding:8px 12px;border-radius:var(--r-pill);font-size:12px;opacity:0;transition:opacity .2s;z-index:9400;pointer-events:none}
#toast.show{opacity:1}

/* Controls overlay (touch layer) */
#controls{position:fixed;inset:0;z-index:8000;pointer-events:auto;touch-action:none}

/* START — centered default */
.startDock{position:absolute;left:50%;top:50%;transform:translate(-50%, -50%) translate(var(--start-x), var(--start-y)) scale(var(--start-scale));transform-origin:center;opacity:var(--start-opacity);will-change:transform,opacity}
.startBtn{width:clamp(60px,13vmin,92px);height:clamp(60px,13vmin,92px);border-radius:14px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.16);color:#fff;font-weight:800;letter-spacing:.5px;box-shadow:0 6px 18px rgba(0,0,0,.35) inset,0 2px 8px rgba(0,0,0,.35)}

/* Touchpad — bottom-right default */
.padDock{position:absolute;right:calc(14px + var(--sa-right));bottom:calc(14px + var(--sa-bottom));transform:translate(var(--pad-x), var(--pad-y)) scale(var(--pad-scale));transform-origin:bottom right;opacity:var(--pad-opacity);will-change:transform,opacity}
.pad{position:relative;width:min(54vmin,48vw);height:min(54vmin,48vw)}
.padRing{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:100%;height:100%;border-radius:50%;border:2px solid rgba(255,255,255,.28);background:radial-gradient(circle at 50% 50%, rgba(255,255,255,.08), rgba(255,255,255,.04))}
.padKnob{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:36%;height:36%;border-radius:50%;background:rgba(255,255,255,.20);border:1px solid rgba(255,255,255,.35);box-shadow:0 6px 18px rgba(0,0,0,.35) inset,0 2px 8px rgba(0,0,0,.35)}

/* Coach HUD (non-blocking) */
#coach{position:fixed;inset:0;z-index:9000;pointer-events:none}
#coach.hidden{display:none}
.coachTop{position:absolute;left:50%;top:calc(12px + var(--sa-top));transform:translateX(-50%);background:var(--glass);color:#fff;border:1px solid var(--border);padding:8px 12px;border-radius:var(--r-pill);font-size:13px;pointer-events:none}
.coachBottom{position:absolute;left:50%;bottom:calc(12px + var(--sa-bottom));transform:translateX(-50%);display:flex;gap:var(--gap);align-items:center;background:var(--glass);color:#fff;border:1px solid var(--border);padding:8px 10px;border-radius:var(--r-pill);pointer-events:auto}
.link{color:#cfe3ff;text-decoration:underline;opacity:.9}.link:active{opacity:1}

/* Editor modal (top-most) */
#editorOverlay{position:fixed;inset:0;display:grid;place-items:center;z-index:10000;background:rgba(0,0,0,.45)}
#editorOverlay.hidden{display:none}
.editor{width:min(560px,94vw);padding:16px;border-radius:var(--r-xl);background:rgba(25,25,25,.96);color:#fff;border:1px solid var(--border);display:grid;gap:12px}
.editorTitle{font-weight:800}.editor label{display:flex;justify-content:space-between;gap:10px;align-items:center}.editor input{width:60%}.editorActions{display:flex;gap:10px;justify-content:flex-end}

/* Placement outlines */
.placing #startDock, .placing #padDock{outline:2px dashed rgba(255,255,255,.4);border-radius:14px}

/* Portrait visual guard */
@media (orientation:portrait){ #stage{filter:blur(2px);pointer-events:none} }

.hidden{display:none!important}
@media (prefers-reduced-motion: reduce){ .btn{transition:none} #toast{transition:none} }

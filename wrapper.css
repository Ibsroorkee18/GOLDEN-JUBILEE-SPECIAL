:root{
  --ui-scale: 1.25;           /* default size on phones */
  --ui-opacity: 0.9;          /* control bar opacity */
  --pad-size: min(48vmin, 64vw);
  --btn-size: clamp(56px, 16vmin, 96px);
  --gap: 14px;
  --radius: 22px;
  --glass: rgba(18,18,18,0.45);
  --glass-strong: rgba(18,18,18,0.65);
  --border: rgba(255,255,255,0.28);
  --active: rgba(255,255,255,0.45);
  --accentA: #82f18a;         /* A button */
  --accentB: #86b6ff;         /* B button */
  --safe-bottom: env(safe-area-inset-bottom, 10px);
  --safe-top: env(safe-area-inset-top, 10px);
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;margin:0;overscroll-behavior:none;background:#0b0e11;color:#e8f0f2;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica Neue,Arial,Noto Sans,sans-serif}
#wrap{position:fixed;inset:0;display:grid;grid-template-rows:1fr auto}

/* Stage (game area) */
#stage{position:relative;overflow:hidden;background:#000}
#gameframe{position:absolute;inset:0;width:100%;height:100%;border:0;background:#000}

/* Starter overlay */
#starter{position:absolute;inset:0;display:grid;place-items:center;background:radial-gradient(120vmax 120vmax at 50% 50%, rgba(0,0,0,.78), rgba(0,0,0,.92));z-index:10}
#starter .card{padding:18px 22px;text-align:center;border-radius:18px;background:var(--glass);border:1px solid var(--border);backdrop-filter:blur(6px)}
#starter .title{font-weight:800;margin-bottom:6px}
#starter .sub{opacity:.8;margin-bottom:12px}
.btn{display:inline-grid;place-items:center;border:1px solid var(--border);border-radius:999px;background:rgba(255,255,255,0.12);color:#fff;cursor:pointer;user-select:none}
.btn.pill{padding:12px 20px;font-weight:700}
.btn.ghost{background:rgba(255,255,255,0.08)}
.btn:active,.btn.active{background:var(--active);border-color:#fff}

/* Top bar */
#topbar{position:absolute;left:10px;right:10px;top:var(--safe-top);display:flex;gap:10px;justify-content:flex-end;z-index:5}
#topbar .btn{padding:6px 10px;border-radius:999px}

/* Bottom control bar */
#controls{
  position:relative;
  padding:12px 14px calc(18px + var(--safe-bottom));
  background:linear-gradient(to top, rgba(0,0,0,0.55), rgba(0,0,0,0.25));
}
#controlInner{
  display:flex;
  justify-content:center;
  align-items:flex-end;
  gap: clamp(12px, 3vw, 28px);
  transform: scale(var(--ui-scale));
  transform-origin: bottom center;
  opacity: var(--ui-opacity);
  transition: transform .15s ease, opacity .15s ease;
}

/* D-pad (round, centered, fat touch targets) */
.dpad{
  position:relative;
  width:var(--pad-size);
  height:var(--pad-size);
  max-width:520px; max-height:520px;
  background: var(--glass-strong);
  border:1px solid var(--border);
  border-radius:50%;
  backdrop-filter: blur(6px);
  box-shadow: 0 10px 24px rgba(0,0,0,.35) inset, 0 4px 18px rgba(0,0,0,.35);
}
.dpad .seg{
  position:absolute;
  width:40%;
  height:34%;
  border:1px solid var(--border);
  background: rgba(255,255,255,0.12);
  border-radius:16px;
}
.dpad .seg.up{    left:30%; top:6%;}
.dpad .seg.down{  left:30%; bottom:6%;}
.dpad .seg.left{  top:33%; left:6%; width:34%; height:40%;}
.dpad .seg.right{ top:33%; right:6%; width:34%; height:40%;}
.dpad .seg:active, .dpad .seg.active{background:var(--active);border-color:#fff}
.dpad .nub{
  position:absolute; left:50%; top:50%; width:26%; height:26%;
  transform:translate(-50%,-50%);
  background: rgba(255,255,255,0.10);
  border:1px dashed rgba(255,255,255,0.18);
  border-radius:50%;
}

/* Actions */
.actions{display:grid;grid-template-columns:1fr;gap:var(--gap);align-items:end}
.actions .action{
  width:var(--btn-size); height:var(--btn-size);
  font-size: clamp(18px, 5.5vmin, 24px); font-weight:900;
  box-shadow: 0 6px 18px rgba(0,0,0,.35) inset, 0 2px 8px rgba(0,0,0,.35);
}
.actions .A{background:color-mix(in srgb, var(--accentA) 55%, rgba(255,255,255,0.12));}
.actions .B{background:color-mix(in srgb, var(--accentB) 55%, rgba(255,255,255,0.12));}
.actions .full{width:var(--btn-size); height:calc(var(--btn-size) * .6); border-radius:14px}

/* Settings dialog */
dialog#settings{
  width:min(520px, 92vw); border:1px solid var(--border); border-radius:16px;
  padding:16px; background:var(--glass); color:#fff; backdrop-filter:blur(8px)
}
dialog::backdrop{background:rgba(0,0,0,.5)}
#settings h3{margin:0 0 10px 0}
#settings .row{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:10px 0}
#settings input[type="range"]{width:52%}
#settings .buttons{justify-content:flex-end}
#settings .btn{padding:8px 14px}
#settings .btn.ghost{background:rgba(255,255,255,0.08)}
#settings .hint{opacity:.75;margin-top:8px;font-size:.9em}

/* Layout swap (left-handed) */
.lefty #controlInner{flex-direction: row-reverse}

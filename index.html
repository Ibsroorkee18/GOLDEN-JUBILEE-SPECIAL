<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Play</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="wrapper.css" />
</head>
<body>
  <div id="wrap">
    <!-- Gate: MUST be fullscreen + landscape -->
    <div id="gate">
      <div class="gate-card">
        <div class="gate-title">Rotate & go fullscreen</div>
        <div class="gate-sub">Phone-only • fullscreen landscape required</div>
        <div class="gate-actions">
          <button id="enterFS" class="btn">Enter Fullscreen</button>
        </div>
        <div class="gate-hint">If lock fails, rotate your phone horizontally.</div>
      </div>
    </div>

    <!-- Game fills screen -->
    <div id="stage" aria-hidden="true">
      <iframe id="gameframe" allow="autoplay; fullscreen; gamepad"></iframe>

      <!-- Top-right HUD -->
      <div id="topbar">
        <button id="landscape" class="btn" title="Lock landscape">⟲</button>
        <button id="fullscreenBtn" class="btn" title="Fullscreen">⤢</button>
        <button id="openPlacement" class="btn" title="Adjust controls">⚙️</button>
        <button id="resetBtn" class="btn" title="Reset game & restore START">RESET</button>
      </div>

      <div id="toast" role="status" aria-live="polite"></div>
    </div>

    <!-- Controls overlay -->
    <div id="controls" aria-hidden="true" aria-label="Touch Controls">
      <!-- START (SPACE) — movable -->
      <div id="startDock" class="startDock" data-drag="start">
        <button id="startBtn" class="startBtn" data-key="Space">START</button>
      </div>

      <!-- Circular touchpad — movable -->
      <div id="padDock" class="padDock" data-drag="pad">
        <div id="pad" class="pad" aria-label="Touchpad">
          <div class="padRing"></div>
          <div class="padKnob"></div>
        </div>
      </div>
    </div>

    <!-- Placement overlay (ALWAYS on page load) -->
    <div id="placement">
      <div class="place-card">
        <h3>Place your controls</h3>

        <div class="checklist">
          <div class="row">
            <span class="tag">Touchpad</span>
            <span id="padStatus" class="status off">Not set</span>
            <div class="actions">
              <button id="editPad" class="btn sm">Edit</button>
              <button id="movePad" class="btn sm ghost">Move</button>
            </div>
          </div>
          <div class="row">
            <span class="tag">START</span>
            <span id="startStatus" class="status off">Not set</span>
            <div class="actions">
              <button id="editStart" class="btn sm">Edit</button>
              <button id="moveStart" class="btn sm ghost">Move</button>
            </div>
          </div>
        </div>

        <div class="place-actions">
          <button id="placeSet" class="btn" disabled>SET</button>
          <button id="placeDefaults" class="btn ghost" type="button">Defaults</button>
          <button id="forceStart" class="btn ghost" type="button" title="Use if your device blocks the set checks">Start Anyway</button>
        </div>
        <p class="hint">This placement appears on every page reload. RESET only restarts the game.</p>
      </div>
    </div>

    <!-- Centered editor (for pad OR start) -->
    <div id="editorOverlay" class="hidden" role="dialog" aria-modal="true">
      <div class="editor">
        <div class="editorTitle" id="editorTitle">Edit Control</div>
        <label>Size <input id="editSize" type="range" min="0.9" max="1.7" step="0.05"></label>
        <label>Opacity <input id="editOpacity" type="range" min="0.25" max="1.0" step="0.05"></label>
        <div class="editorActions">
          <button id="editorDone" class="btn">Done</button>
          <button id="editorCancel" class="btn ghost">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Move mode bubble -->
    <button id="finishMove" class="bubble hidden">Done Moving</button>
  </div>

  <script src="wrapper.js" defer></script>
</body>
</html>
